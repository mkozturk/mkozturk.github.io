<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kaan Öztürk">
<meta name="dcterms.date" content="2024-02-05">
<meta name="description" content="Set up a virtual environment">

<title>Kaan Öztürk - Project structuring for the minimalist data scientist - 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../../styles.css">
<meta name="twitter:title" content="Kaan Öztürk - Project structuring for the minimalist data scientist - 3">
<meta name="twitter:description" content="Set up a virtual environment">
<meta name="twitter:image" content="https://mkozturk.com/posts/en/2024/project-structuring-for-the-minimalist-data-scientist-3/tai-bui-wf4F-KgJKgc-unsplash.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Kaan Öztürk</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blog" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Blog</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-blog">    
        <li>
    <a class="dropdown-item" href="../../../../blog.html" rel="" target="">
 <span class="dropdown-text">All posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../blog-en.html" rel="" target="">
 <span class="dropdown-text">English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../blog-tr.html" rel="" target="">
 <span class="dropdown-text">Türkçe</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Project structuring for the minimalist data scientist - 3</h1>
                  <div>
        <div class="description">
          Set up a virtual environment
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">data science software</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kaan Öztürk </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 5, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#creating-and-activating-a-virtual-environment" id="toc-creating-and-activating-a-virtual-environment" class="nav-link active" data-scroll-target="#creating-and-activating-a-virtual-environment">Creating and activating a virtual environment</a></li>
  <li><a href="#why-use-virtual-environments" id="toc-why-use-virtual-environments" class="nav-link" data-scroll-target="#why-use-virtual-environments">Why use virtual environments?</a></li>
  <li><a href="#the-requirements.txt-file" id="toc-the-requirements.txt-file" class="nav-link" data-scroll-target="#the-requirements.txt-file">The <code>requirements.txt</code> file</a>
  <ul class="collapse">
  <li><a href="#collecting-required-packages" id="toc-collecting-required-packages" class="nav-link" data-scroll-target="#collecting-required-packages">Collecting required packages</a></li>
  <li><a href="#multiple-requirements-files" id="toc-multiple-requirements-files" class="nav-link" data-scroll-target="#multiple-requirements-files">Multiple requirements files</a></li>
  </ul></li>
  <li><a href="#environments-are-disposable" id="toc-environments-are-disposable" class="nav-link" data-scroll-target="#environments-are-disposable">Environments are disposable</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>After you have <a href="../../../../posts/en/2024/project-structuring-for-the-minimalist-data-scientist-2/index.html">decided on what your project</a> is going to be, a so-called “virtual environment” is frequently useful. This is simply a directory which holds the libraries that are imported by your programs, such as <em>numpy</em>, <em>pandas</em> or <em>matplotlib</em>.</p>
<p>RealPython published a <a href="https://realpython.com/python-virtual-environments-a-primer/">comprehensive guide to working with Python virtual environments</a>. I suggest reading this primer to gain a good understanding. Here I describe only how I use them.</p>
<section id="creating-and-activating-a-virtual-environment" class="level2">
<h2 class="anchored" data-anchor-id="creating-and-activating-a-virtual-environment">Creating and activating a virtual environment</h2>
<p>This is a simple process. Enter the directory you created for your project (the “project root”), and run the following commands in the terminal:</p>
<div class="sourceCode" id="annotated-cell-1"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> venv .venv</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-2" class="code-annotation-target"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source .venv/bin/activate</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span> <span class="ex">$</span> pip install numpy pandas matplotlib</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-annotation="1" data-code-lines="1" data-code-cell="annotated-cell-1">Using the standard library package <code>venv</code>, create a virtual environment in the subdirectory <code>.venv</code></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-annotation="2" data-code-lines="2" data-code-cell="annotated-cell-1">Activate the virtual environment by running its activation script.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-annotation="3" data-code-lines="3" data-code-cell="annotated-cell-1">The shell prompt changes to indicate that the virtual environment is active. Now the <code>pip</code> command installs the packages into the <code>.venv</code> directory. Any <code>python</code> command will refer to this directory to find packages.</span>
</dd>
</dl>
<p>When you don’t want to use this virtual environment, deactivate it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span> <span class="ex">$</span> deactivate</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command does not remove the virtual environment. It can be reactivated again with <code>source .venv/bin/activate</code>.</p>
<p>A sophisticated IDE such as VSCode can detect the presence of a virtual environment in its working directory and use it for execution of programs.</p>
</section>
<section id="why-use-virtual-environments" class="level2">
<h2 class="anchored" data-anchor-id="why-use-virtual-environments">Why use virtual environments?</h2>
<p>Initially, I resisted the idea of using a new virtual environment for every project (because minimalism!). After all, I was only working with Jupyter notebooks, and I could not see what would go wrong with using a single, global environment.</p>
<p>Later, as my assignments became more complicated, I realized the value of virtual environments in my work.</p>
<p>The first problem is the proliferation of libraries. Different problems require different libraries, and you keep installing them on the global environment. A package management system like <code>pip</code> keeps track of mutual dependencies and makes sure that packages do not clash. When you have <span class="math inline">\(n\)</span> packages, there are about <span class="math inline">\(n^2\)</span> interdependencies to check. The probability of some incompatibility increases rapidly. When you use a virtual environment for your project, you do not install packages you don’t need, and intercompatibility can be achieved easily.</p>
<p>Some packages are not updated as frequently as others. For example, package A might require an older version of package B. However, another package C, which you need for some other project, may require a newer version of B. A good way to remove this problem is to use two virtual environments, one with A and the old B, another one with C and the new B.</p>
<p>So, multiple virtual environments actually simplify your work. They put clear boundaries around your project, reduce the complexity of your work, and keeps the organization neat. That’s why I like them from a minimalistic point of view.</p>
<p>A very important reason for using virtual environments is reproducibility. Frequently, you need to collaborate with other software developers, data engineers, or front-end developers. You develop some data-science algorithms for data extraction, model training, output generation, visualization, data summarization, and hand your code to your coworkers. They will have to reproduce your code and put it inside a workflow. When you install a virtual environment at the start of your project and install only the required packages, your dependencies will be clear. If you use a global environment, chances are you’ll introduce some dependency you don’t know about.</p>
<p>Later in this series, I’ll describe how to set up your code as an installable package. Then, you can install the project itself in its own environment as an editable install, without worrying about breaking the code in other projects.</p>
</section>
<section id="the-requirements.txt-file" class="level2">
<h2 class="anchored" data-anchor-id="the-requirements.txt-file">The <code>requirements.txt</code> file</h2>
<p>Usually you install several packages at once in an environment, so it makes sense to write them down in a text file and tell <code>pip</code> to read from it. By convention, this file is named <code>requirements.txt</code>.</p>
<p>Here is an example <code>requirements.txt</code> file:</p>
<pre><code>mysql-connector-python&gt;=8.0
numpy
pandas
scipy&gt;=1.11
scikit_learn
matplotlib
ipykernel</code></pre>
<p>This file indicates that the <code>mysql-connector-python</code> package must have version 8.0 or above, <code>scipy</code> must have version 1.11 and above, and the other packages should be the newest versions as long as they are compatible with each other.</p>
<p>We can install the packages in the virtual environment</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span> <span class="ex">$</span> pip install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want an exact version of a package, you can use <code>==</code> instead of <code>&gt;=</code>.</p>
<p>I usually start with a <code>requirements.txt</code> file in a new environment. Later, whenever I install a new package with <code>pip</code>, I add the name of the package to this list.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is better to install packages with a single <code>pip</code> call instead of several calls. That way <code>pip</code> can inspect dependencies as a whole, and choose appropriate versions in order to avoid inconsistencies.</p>
</div>
</div>
<section id="collecting-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="collecting-required-packages">Collecting required packages</h3>
<p>If you have already installed some packages in your environment, you can use <code>pip freeze</code> to create a requirements file:</p>
<p><code>$ pip freeze &gt; requirements.txt</code></p>
<p>This shell command outputs a list of all installed packages and their versions, and stores them in the file <code>requirements.txt</code></p>
<p>A useful alternative is <code>pipreqs</code>, which is a separate tool. You can install it with <code>pip</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install pipreqs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, the <code>pipreqs</code> command scans all <code>import</code> statements in your Python source files in the current directory and creates a <code>requirements.txt</code> file using the relevant package names.</p>
<p>Since it reads from source files, <code>pipreqs</code> can be used even if there are no installed packages in the environment.</p>
<p><code>pip freeze</code> returns the list of all packages in the environment, while <code>pipreqs</code> returns only those imported in the source code. This is useful if you want to create a requirements file for a new project without installing packages.</p>
</section>
<section id="multiple-requirements-files" class="level3">
<h3 class="anchored" data-anchor-id="multiple-requirements-files">Multiple requirements files</h3>
<p>Even within a single project, you might have different requirements for different purposes. In that case, it might make sense to create several requirements files.</p>
<p>For example, you might be developing a predictive algorithm. The main algorithm itself may depend on <em>numpy</em>, <em>pandas</em>, and <em>scikit-learn</em>. These are the only requirements when your code is put into production. However, in your work you need to experiment using Jupyter notebooks and visualize the output, so you need <em>ipykernel</em> and <em>matplotlib</em> packages.</p>
<p>You can then create two separate requirements files. The file <code>requirements.txt</code> contains:</p>
<pre><code>numpy
pandas
scikit-learn</code></pre>
<p>and another file, named <code>requirements-dev.txt</code>, contains</p>
<pre><code>ipykernel
matplotlib</code></pre>
<p>When the software team uses your code in their work, they’ll need only to run</p>
<p><code>$ pip install -r requirements.txt</code>.</p>
<p>You, however, also run <code>$ pip install -r requirements-dev.txt</code> after the first command in order to add the extra packages needed for your work.</p>
</section>
</section>
<section id="environments-are-disposable" class="level2">
<h2 class="anchored" data-anchor-id="environments-are-disposable">Environments are disposable</h2>
<p>One thing that annoyed me about virtual environments is that they are large (100s of MBs), and they are repeated: You install the same packages for different projects.</p>
<p>While this is true, you don’t have to keep all the environments on disk all the time. If you are short on space, just erase the <code>.venv</code> directory. When you have a <code>requirements.txt</code> file, you can recreate the virtual environment in a matter of minutes (provided you have an internet connection).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can make several projects share a single virtual environment. First create a directory named <code>.venvs</code> in your home directory, and create some specialized environments inside it, e.g., <code>.venvs/analysis</code> for data analysis and visualization.</p>
</div>
</div>
<p>Since we treat environments as disposable, we do not track them in version-control systems such as Git. If the <code>.venv</code> directory is added to the contents of the file <code>.gitignore</code>, Git just ignores them.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>